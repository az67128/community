<script>
  import Tag from "./Tag.svelte";
  export let resource;
  export let selectedTags;
  export let toggleTag;
  import { timeSince } from "resources/helpers.js";

  const getUpdatedText = resource => {
    const text = timeSince(new Date(resource.last_updated));
    if (text.indexOf("today") === -1 && text.indexOf("yesterday") === -1) {
      return text + " ago";
    } else {
      return text;
    }
  };
</script>

<style>
  .name code {
    font-size: inherit;
    padding: 0.2em 0.4em;
    /* this is `--prime` with reduced opacity */
    background-color: rgba(21, 151, 148, 0.07);
  }
  .scrapedMetadata {
    display: flex;
    max-width: 40rem;
    justify-content: space-between;
  }
  .scrapedMetadata span {
    margin-right: 0.5rem;
  }
  .description {
    margin: 0.5rem 0;
  }
  .tagsWrapper {
    display: flex;
    flex-wrap: wrap;
  }
  .headlineCode {
    max-width: 100%;
    word-break: break-word;
    white-space: normal;
  }
</style>

<h4>
  <a class="name" href={resource.url} target="_blank">
    {#if resource.isNpmPackage}
      <code class="headlineCode">{resource.name}</code>
    {:else}{resource.name}{/if}
  </a>

</h4>
{#if resource.description}
  <p class="description">{resource.description}</p>
{/if}
<div class="tagsWrapper">
  {#each resource.tags as tag}
    <Tag name={tag} selected={selectedTags.has(tag)} toggle={toggleTag} />
  {/each}
  {#if resource.isNpmPackage}
    <small>
      <a href="https://www.npmjs.com/package/{resource.name}" target="_blank">
        npm
      </a>
    </small>
  {/if}
</div>
{#if resource.stars || resource.last_updated}
  <small class="scrapedMetadata">
    {#if resource.last_updated}
      <span>updated {getUpdatedText(resource)}</span>
    {/if}
    {#if resource.stars}
      <span>{resource.stars} ‚≠ê</span>
    {/if}
  </small>
{/if}
